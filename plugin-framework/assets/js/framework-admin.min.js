"use strict";window.alpusPlugin||(window.alpusPlugin={}),function(e){alpusPlugin.initNotifications=function(){e("#wpbody-content .wrap:not(.alpus-plugin-notices)").prependTo(e("#wpbody-content .templates-builder")),e("div.updated, div.error, div.notice").not(".inline, .below-h2").appendTo(e(".alpus-plugin-notices"))},alpusPlugin.initDependency=function(){var a=e("#pluginform");a.find(".display-condition").each((function(){var t,n=e(this),i=n.data("condition-option"),l=n.data("condition-operator"),s=n.data("condition-value"),o=n.data("condition-id"),r=a.find("#"+i),p=[];"yes"==s?s=!0:"no"==s&&(s=!1),r.data("conditions")&&(p=r.data("conditions")),p.push({operator:l,value:s,target:n.find("#"+o),wrapper:n}),r.addClass("condition-trigger"),r.data("conditions",p),t=r.val(),"checkbox"==r.attr("type")&&(t=r.is(":checked")),"=="==l?Array.isArray(s)?-1!=s.indexOf(t)?n.addClass("show"):n.removeClass("show"):s==t?n.addClass("show"):n.removeClass("show"):"!="==l&&(Array.isArray(s)?-1==s.indexOf(t)?n.addClass("show"):n.removeClass("show"):s!=t?n.addClass("show"):n.removeClass("show"))})),a.find(".condition-trigger").on("change",(function(){var a=e(this),t=a.data("conditions"),n=a.val();"checkbox"==a.attr("type")&&(n=a.is(":checked")),Array.isArray(t)&&t.length>0&&t.forEach((function(e,a){"=="==e.operator?Array.isArray(e.value)?-1!=e.value.indexOf(n)?e.wrapper.addClass("show"):e.wrapper.removeClass("show"):e.value==n?e.wrapper.addClass("show"):e.wrapper.removeClass("show"):"!="==e.operator&&(Array.isArray(e.value)?-1==e.value.indexOf(n)?e.wrapper.addClass("show"):e.wrapper.removeClass("show"):e.value!=n?e.wrapper.addClass("show"):e.wrapper.removeClass("show"))}))}))},alpusPlugin.prepare=function(){alpusPlugin.initNotifications()},alpusPlugin.managePlugin=function(){var a="",t="",n="";function i(t){"object"==typeof t&&void 0!==t.message?(a.text(t.message),void 0!==t.url?t.hash==n?(a.text(alpus_plugin_framework_vars.texts.failed),s({})):(n=t.hash,e.post(t.url+"&activate-multi=true",t,(function(e){l(),a.text(t.message)})).fail(i)):(t.done,s(t))):s(t)}function l(){e.post(alpus_plugin_framework_vars.ajax_url,{action:"alpus_install_plugin",nonce:alpus_plugin_framework_vars.nonce,plugin:t},i)}function s(t){void 0!==t.message?a.text(t.message):"string"==typeof t&&a.text(t),(void 0!==t.done&&1==t.done||"success"==t)&&a.closest(".plugin-card").find(".alpus_plugin_status").prop("checked",!0),setTimeout((function(){a.closest(".action-links").removeClass("disabled"),a.closest(".plugin-card").find(".alpus_plugin_status").prop("disabled",!1),a.closest(".plugin-card").removeClass("installing"),e(".alpus-plugin-install-button").css("pointer-events","auto")}),1e3)}e(document).on("click",".alpus-plugin-install-button",(function(n){n.preventDefault(),a=e(this),t=a.data("plugin"),a.closest(".plugin-card").addClass("installing"),e(".alpus-plugin-install-button").css("pointer-events","none"),l()})),e(document).on("change",".alpus_plugin_status",(function(a){var t=e(this),n=t.data("url");t.closest("#wpcontent").css("pointer-events","none"),e.post(alpus_plugin_framework_vars.ajax_url,{action:"alpus_manage_plugin",nonce:alpus_plugin_framework_vars.nonce,plugin:n,status:t.is(":checked")},(function(e){"success"==e&&(1==t.is(":checked")?alpus_plugin_framework_vars.active_plugins++:alpus_plugin_framework_vars.active_plugins--,alpus_plugin_framework_vars.active_plugins||alpus_plugin_framework_vars.core_plugin?window.location.reload():window.location.href=alpus_plugin_framework_vars.admin_url)})).fail((function(e){}))}))},alpusPlugin.initWpColorPicker=function(){e.fn.wpColorPicker&&e("input.alpus-color-picker:not(.wp-color-picker)").wpColorPicker()},alpusPlugin.uploadOption={selectors:{imgPreview:".alpus-upload-img-preview",uploadButton:".alpus-upload-button",imgUrl:".alpus-upload-img-url",resetButton:".alpus-upload-button-reset"},onImageChange:function(){var a=e(this).val(),t=new RegExp("(http|ftp|https)://[a-zA-Z0-9@?^=%&amp;:/~+#-_.]*.(gif|jpg|jpeg|png|ico|svg)"),n=e(this).parent().find(alpusPlugin.uploadOption.selectors.imgPreview).first();n.length<1&&(n=e(this).parent().parent().find(alpusPlugin.uploadOption.selectors.imgPreview).first()),t.test(a)?n.html('<img src="'+a+'" />'):n.html("")},onButtonClick:function(a){a.preventDefault();var t,n=e(this).attr("id").replace(/-button$/,"").replace(/(\[|\])/g,"\\$1");if(t)t.open();else{var i=[new wp.media.controller.Library({library:wp.media.query(),multiple:!1,title:"Choose Image",priority:20,filterable:"uploaded"})];(t=wp.media.frames.downloadable_file=wp.media({title:"Choose Image",library:{type:""},button:{text:"Choose Image"},multiple:!1,states:i})).on("select",(function(){var a=t.state().get("selection").first().toJSON();e("#"+n).val(a.url),alpusPlugin.uploadOption.triggerImageChange()})),t.open()}},onResetClick:function(){var a=e(this),t=a.attr("id").replace(/(\[|\])/g,"\\$1"),n=a.attr("id").replace(/-button-reset$/,"").replace(/(\[|\])/g,"\\$1"),i=e("#"+t).data("default");e("#"+n).val(i),alpusPlugin.uploadOption.triggerImageChange()},triggerImageChange:function(){e(alpusPlugin.uploadOption.selectors.imgUrl).trigger("change")},init:function(){"undefined"!=typeof wp&&void 0!==wp.media&&(e(document).on("change",alpusPlugin.uploadOption.selectors.imgUrl,alpusPlugin.uploadOption.onImageChange),e(document).on("click",alpusPlugin.uploadOption.selectors.uploadButton,alpusPlugin.uploadOption.onButtonClick),e(document).on("click",alpusPlugin.uploadOption.selectors.resetButton,alpusPlugin.uploadOption.onResetClick))}},alpusPlugin.initUISlider=function(){e(".wp-slider").length&&(e(".wp-slider").each((function(){var a=e(this).data("range");e(this).slider({animate:"fast",min:a.min,max:a.max,step:a.step,value:a.value})})),e(".wp-slider").on("slide",(function(a,t){e(this).siblings("input").val(t.value)})),e(".wp-slider-wrapper input").on("input",(function(){var a=e(this);a.siblings(".wp-slider").slider("option",{value:a.val()})})))},alpusPlugin.initButtonSet=function(){e(".alpus-set-item").on("click",(function(){var a=e(this),t=a.attr("data-value");a.addClass("active").siblings().removeClass("active"),a.parent().next("input").val(t),a.parent().next("input").trigger("change")}))},alpusPlugin.initAdminTab=function(){e(".alpus-plugin-options.use-tab nav a").on("click",(function(a){a.preventDefault();let t=e(this),n=t.attr("data-tab");t.siblings().removeClass("nav-tab-active"),t.addClass("nav-tab-active"),e(".alpus-plugin-options").find(".tab-content.active").removeClass("active"),e(".alpus-plugin-options").find(".tab-content."+n).addClass("active")}))},e.fn.saveRepeaterElement=function(a){var t,n=e(this),i=n.serializeRepeaterElement(),l=n.find(".alpus-repeater-wrapper"),s=l.attr("id"),o=e.urlParam("tab");i.append("security",l.data("nonce")),t=alpus_plugin_framework_vars.admin_url+"admin.php?action=alpus_save_repeater_element&tab="+o+"&repeater_id="+s+"&page="+e.urlParam("page"),e.ajax({type:"POST",url:t,data:i,contentType:!1,processData:!1,success:function(e){a&&a.removeClass("show")}})},e.fn.serializeRepeaterElement=function(){var a=e(this),t=new FormData,n=e(a).find(":input").serializeArray();return e.each(n,(function(e,a){a.name;t.append(a.name,a.value)})),t},e.fn.formatRepeaterTitle=function(){var a=e(this),t=a.find(":input"),n=a.find("span.title").data("title_format"),i=a.find(".subtitle").data("subtitle_format"),l=new RegExp("[^%%]+(?=[%%])","g");if(void 0!==n)var s=n.match(l);if(void 0!==i)var o=i.match(l);e.each(t,(function(a,t){if(void 0!==e(t).attr("id")){var l=e(t).attr("id"),r=l.split("_");r.pop(),l=r.join("_");var p=e(t).val();null!=s&&void 0!==s&&-1!==s.indexOf(l)&&(n=n.replace("%%"+l+"%%",p)),null!=o&&void 0!==o&&-1!==o.indexOf(l)&&(i=i.replace("%%"+l+"%%",p))}})),""!==n&&a.find("span.title").html(n),""!==i&&a.find(".subtitle").html(i),e(document).trigger("alpus-repeater-element-item-title",[a])},e.urlParam=function(e){var a=new RegExp("[?&]"+e+"=([^&#]*)").exec(window.location.search);return null!==a&&(a[1]||0)},e(document).on("click",".alpus-repeater-title",(function(a){var t=e(a.target),n=t.closest(".alpus-repeater-row"),i=n.find(".alpus-repeater-content");if(t.hasClass("alpus-onoff")||t.hasClass("alpus-icon-drag"))return!1;n.is(".alpus-repeater-row-opened")?i.slideUp(400):i.slideDown(400),n.toggleClass("alpus-repeater-row-opened")})),e(document).on("click",".alpus-add-box-button",(function(a){a.preventDefault();var t=e(this),n=t.data("box_id"),i=t.data("closed_label"),l=t.data("opened_label"),s=t.closest(".alpus-repeater-wrapper").attr("id"),o=wp.template("alpus-repeater-element-add-box-content-"+s);""!==n&&(e("#"+n).html(o({index:"box_id"})).slideToggle(),""!==i&&(t.html()===i?t.html(l).removeClass("closed"):t.html(i).addClass("closed")),e(document).trigger("alpus-add-box-button-repeater",[t]))})),e(document).on("click",".alpus-add-box-buttons .alpus-save-button",(function(a){a.preventDefault();var t=e(this).parents(".alpus-add-box"),n=e(this).closest(".alpus-repeater-wrapper").attr("id"),i=t.find(".spinner"),l=e(this).parents(".repeater-element"),s=t.find(":input"),o=0,r=e('<input type="hidden">');l.find(".alpus-repeater-row").each((function(){var a=parseInt(e(this).data("item_key"));o<=a&&(o=a+1)})),r.val(o),o=r.val();var p=wp.template("alpus-repeater-element-item-"+n),u=e(p({index:o}));i.addClass("show"),e.each(s,(function(a,t){if(void 0!==e(t).attr("id")){var n=e(t).attr("id"),i=e(t).val();n="radio"===e(t).attr("type")?(n=(n=e(t).closest(".alpus-radio").attr("id")).replace("new_","")+"_"+o)+"-"+i:n.replace("new_","")+"_"+o,e(t).is(":checked")&&e(u).find("#"+n).prop("checked",!0),(e(t).hasClass("alpus-post-search")||e(t).hasClass("alpus-term-search"))&&e(u).find("#"+n).html(e("#"+e(t).attr("id")).html()),e(u).find("#"+n).val(i)}})),e(u).formatRepeaterTitle();var d=e('<input type="hidden">').val("yes");e(document).trigger("alpus-repeater-element-item-before-add",[t,u,d]);setTimeout((function(){if("yes"===d.val()){e(l).find(".alpus-repeater-elements").append(u),e(t).html(""),e(t).prev(".alpus-add-box-button").trigger("click"),l.saveRepeaterElement();setTimeout((function(){e(l).find(".highlight").removeClass("highlight")}),2e3)}}),1e3)})),e(document).on("click",".alpus-repeater-row .alpus-save-button",(function(a){a.preventDefault();var t=e(this).closest(".repeater-element"),n=e(this).closest(".alpus-repeater-row"),i=n.find(".spinner");n.formatRepeaterTitle();var l=e('<input type="hidden">').val("yes");e(document).trigger("alpus-repeater-element-item-before-update",[t,n,l]),"yes"===l.val()&&(i.addClass("show"),t.saveRepeaterElement(i))})),e(document).on("click",".alpus-repeater-row .alpus-delete-button",(function(a){a.preventDefault();var t=e(this).closest(".repeater-element");e(this).closest(".alpus-repeater-row").remove(),t.saveRepeaterElement()})),alpusPlugin.init=function(){alpusPlugin.initDependency(),alpusPlugin.initWpColorPicker(),alpusPlugin.uploadOption.init(),alpusPlugin.initUISlider(),alpusPlugin.initButtonSet(),alpusPlugin.initAdminTab(),alpusPlugin.managePlugin()},e(window).on("load",(function(){alpusPlugin.init()}))}(jQuery);